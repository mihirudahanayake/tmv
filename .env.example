# Environment Variables Configuration

This file documents all environment variables needed for the application.

## Firebase Cloud Functions Environment Variables

Set these in Firebase Console: **Project Settings → Functions → Runtime environment variables**

### Email Configuration (Gmail)
```
GMAIL_USER = your-email@gmail.com
GMAIL_PASS = xxxx-xxxx-xxxx-xxxx
```

**How to get these:**
1. Go to myaccount.google.com/security
2. Enable 2-Factor Authentication
3. Go to myaccount.google.com/apppasswords
4. Select "Mail" and "Windows Computer"
5. Copy the 16-character password

### WhatsApp Configuration (Twilio) - OPTIONAL
```
TWILIO_ACCOUNT_SID = ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
WHATSAPP_PHONE_NUMBER = +1234567890
```

**How to get these:**
1. Go to twilio.com and create account
2. In Twilio Console, get Account SID and Auth Token
3. Go to Messaging → WhatsApp → Sandbox Settings
4. Get the sandbox phone number

## Environment Variables in Development

If you want to use these locally with emulators, create `.env.local` in the project root:

```
GMAIL_USER=your-email@gmail.com
GMAIL_PASS=your-app-password
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxx
WHATSAPP_PHONE_NUMBER=+1234567890
```

Then load them in your functions:
```javascript
require('dotenv').config();
```

## What Each Variable Does

| Variable | Service | Purpose | Required |
|----------|---------|---------|----------|
| GMAIL_USER | Gmail | Email sender address | ✅ Yes (for email) |
| GMAIL_PASS | Gmail | App password for authentication | ✅ Yes (for email) |
| TWILIO_ACCOUNT_SID | Twilio | Account identifier | ⚠️ Optional (for WhatsApp) |
| TWILIO_AUTH_TOKEN | Twilio | API authentication token | ⚠️ Optional (for WhatsApp) |
| WHATSAPP_PHONE_NUMBER | Twilio | Sandbox/Business phone number | ⚠️ Optional (for WhatsApp) |

## Setting Variables in Firebase Console

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Select your project (tmv1-7fc4f)
3. Go to **Project Settings** (gear icon)
4. Go to **Functions** tab
5. Click **Runtime environment variables**
6. Click **Add variable** for each one
7. Enter the key and value
8. Click **Save**
9. Redeploy functions: `firebase deploy --only functions`

## Verification

After setting variables, you can verify they're loaded:

```bash
firebase functions:log --only tmv-notify
```

You should see:
- ✅ "Email transporter initialized" - Email configured correctly
- ⚠️ "Email not configured" - Missing email variables
- ⚠️ "WhatsApp not configured" - Missing WhatsApp variables

## Security Notes

⚠️ **NEVER** commit `.env` files with real passwords to git
⚠️ **NEVER** hardcode credentials in source code
✅ **DO** use Firebase Console to set environment variables
✅ **DO** use `.env.local` (in .gitignore) for local development only

## Testing Variables

### Test Email Sending
In Firestore Console, create a document in `mail` collection:
```json
{
  "to": ["test@gmail.com"],
  "message": {
    "subject": "Test",
    "text": "Test message",
    "html": "<p>Test message</p>"
  }
}
```

### Test WhatsApp Sending
In Firestore Console, create a document in `whatsapp` collection:
```json
{
  "to": ["+923334567890"],
  "message": "Test message"
}
```

Check Cloud Function logs for success/failure messages.

## Troubleshooting

**Email not sending:**
- Check Gmail user and app password are correct
- Verify 2FA is enabled on Gmail account
- Check Cloud Function logs: `firebase functions:log`

**WhatsApp not sending:**
- Verify Twilio account is active and has credits
- Check WhatsApp sandbox is activated
- Verify phone numbers are in international format: +[country][number]

**Variables not loading:**
- Redeploy after setting variables: `firebase deploy --only functions`
- Wait 2-3 minutes for deployment to complete
- Check logs: `firebase functions:log`
